<!DOCTYPE html>
<html lang="is">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stærðfræðiæfingar - Stika 3a</title>
    
    <!-- Sækjum Tailwind CSS fyrir útlitið -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Sækjum React og ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Sækjum Babel til að skilja JSX kóðann -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Stílar fyrir hreyfingar -->
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;

        // -----------------------------------------------------------------------------
        // ICONS (Táknmyndir)
        // -----------------------------------------------------------------------------
        const IconBase = ({ d, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {d}
            </svg>
        );

        const BookOpen = ({ className }) => <IconBase className={className} d={<><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></>} />;
        const Check = ({ className }) => <IconBase className={className} d={<polyline points="20 6 9 17 4 12"/>} />;
        const X = ({ className }) => <IconBase className={className} d={<><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></>} />;
        const HelpCircle = ({ className }) => <IconBase className={className} d={<><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></>} />;
        const ArrowRight = ({ className }) => <IconBase className={className} d={<><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></>} />;
        const RefreshCw = ({ className }) => <IconBase className={className} d={<><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></>} />;
        const Calculator = ({ className }) => <IconBase className={className} d={<><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="8" y1="6" x2="16" y2="6"/><line x1="16" y1="14" x2="16" y2="14"/><line x1="12" y1="14" x2="12" y2="14"/><line x1="8" y1="14" x2="8" y2="14"/><line x1="16" y1="18" x2="16" y2="18"/><line x1="12" y1="18" x2="12" y2="18"/><line x1="8" y1="18" x2="8" y2="18"/></>} />;
        const Brain = ({ className }) => <IconBase className={className} d={<><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></>} />;
        const ChevronLeft = ({ className }) => <IconBase className={className} d={<polyline points="15 18 9 12 15 6"/>} />;
        const Star = ({ className }) => <IconBase className={className} d={<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>} />;
        const LayoutGrid = ({ className }) => <IconBase className={className} d={<><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></>} />;
        const List = ({ className }) => <IconBase className={className} d={<><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></>} />;

        // -----------------------------------------------------------------------------
        // GÖGN (DATA) - Námsefni og Spurningar
        // -----------------------------------------------------------------------------

        const flokkar = {
          saetisgildi: {
            id: "saetisgildi",
            titill: "Sætisgildi og stórar tölur",
            icon: <LayoutGrid className="w-6 h-6" />,
            litur: "bg-blue-600",
            skyring: "Hér lærir þú um milljónir, milljarða og gildi tölustafa eftir sætum. Mundu að flokka tölur þrjá og þrjá saman (þúsund, milljón, milljarður).",
            daemi: "Talan 5.200.000 er fimm milljónir og tvö hundruð þúsund."
          },
          tugabrot: {
            id: "tugabrot",
            titill: "Tugabrot og samlagning",
            icon: <Calculator className="w-6 h-6" />,
            litur: "bg-emerald-600",
            skyring: "Hér æfum við samlagningu og frádrátt með tugabrotum. Gullna reglan er: Komma undir kommu!",
            daemi: "12,5 + 3,2 = 15,7 (Ekki gleyma kommunni)."
          },
          neikvaedar: {
            id: "neikvaedar",
            titill: "Neikvæðar tölur",
            icon: <Brain className="w-6 h-6" />,
            litur: "bg-purple-600",
            skyring: "Tölur undir núlli. Hugsaðu um hitastig: -5°C er kaldara en -2°C. Því stærri sem talan er við hliðina á mínusnum því minni er hún í raun.",
            daemi: "3 - 5 = -2"
          },
          reiknirod: {
            id: "reiknirod",
            titill: "Reikniröð og svigar",
            icon: <List className="w-6 h-6" />,
            litur: "bg-amber-600",
            skyring: "Reiknireglur segja okkur hvað á að gera fyrst. Svigar ( ) hafa alltaf forgang.",
            daemi: "10 - (2+3) = 5, en 10 - 2 + 3 = 11."
          }
        };

        const createQ = (id, flokkur, tegund, spurning, valkostir, rettSvar, utskyring, por = null) => ({
          id, flokkur, tegund, spurning, valkostir, rettSvar, utskyring, por
        });

        // Búið að fjarlægja öll "debug" dæmi úr listanum
        const gagnagrunnur = {
          saetisgildi: [
            createQ(1, "saetisgildi", "interactive", "Hvernig skrifar þú töluna fimm milljónir?", ["5.000", "500.000", "5.000.000", "50.000.000"], "5.000.000", "Milljón hefur 6 núll."),
            createQ(2, "saetisgildi", "interactive", "Hvert er gildi tölustafsins 4 í tölunni 3.450.000?", ["4 þúsund", "40 þúsund", "400 þúsund", "4 milljónir"], "400 þúsund", "Fjarkinn er í hundraðþúsunda sætinu."),
            createQ(4, "saetisgildi", "interactive", "Hversu mörg núll eru í einum milljarði?", ["6", "8", "9", "12"], "9", "Milljarður er þúsund milljónir (1.000.000.000)."),
            createQ(5, "saetisgildi", "scenario", "Reikistjarnan Jörð er 150 milljón km frá sólu. Mars er 228 milljón km frá sólu. Hversu mörgum milljónum km munar?", ["78 milljón km", "122 milljón km", "50 milljón km", "100 milljón km"], "78 milljón km", "228 - 150 = 78."),
            createQ(6, "saetisgildi", "matching", "Pörum saman tölur og heiti.", null, null, "Mundu fjölda núlla.", [{hugtak:"10.000", gildi:"Tíu þúsund"}, {hugtak:"100.000", gildi:"Hundrað þúsund"}, {hugtak:"1.000.000", gildi:"Ein milljón"}, {hugtak:"10.000.000", gildi:"Tíu milljónir"}]),
            createQ(7, "saetisgildi", "interactive", "Hvaða tala er stærst?", ["1.500.000", "150.000", "15.000.000", "900.000"], "15.000.000", "15 milljónir er stærsta talan hér."),
            createQ(8, "saetisgildi", "interactive", "Bættu 10.000 við töluna 5.090.000.", ["5.091.000", "5.100.000", "5.190.000", "6.090.000"], "5.100.000", "90 þúsund plús 10 þúsund eru 100 þúsund. Svo 5.090.000 + 10.000 = 5.100.000."),
            createQ(10, "saetisgildi", "interactive", "Hvaða tölustafur er í þúsunda sætinu í tölunni 123.456?", ["1", "2", "3", "4"], "3", "Talið frá hægri: einingar(6), tugir(5), hundruð(4), þúsundir(3)."),
            createQ(11, "saetisgildi", "scenario", "Vinningur í happdrætti var 15 milljónir. Þremur systkinum var skipt jafnt. Hvað fékk hvert?", ["3 milljónir", "5 milljónir", "7,5 milljónir", "10 milljónir"], "5 milljónir", "15 deilt með 3 eru 5."),
            createQ(12, "saetisgildi", "interactive", "Skrifaðu töluna: Þrjár milljónir og sjötíu þúsund.", ["3.700.000", "3.070.000", "3.007.000", "3.000.070"], "3.070.000", "Við þurfum 0 í hundraðþúsunda sætið."),
            createQ(13, "saetisgildi", "matching", "Stærðarhlutföll", null, null, "Raðaðu eftir stærð.", [{hugtak:"1000 kr", gildi:"Þúsund kall"}, {hugtak:"1.000.000 kr", gildi:"Milljón"}, {hugtak:"1.000.000.000 kr", gildi:"Milljarður"}]),
            createQ(14, "saetisgildi", "interactive", "Hvað vantar upp á að 900.000 verði að 1 milljón?", ["1.000", "10.000", "100.000", "1.000.000"], "100.000", "900 þúsund + 100 þúsund = 1000 þúsund = 1 milljón.")
          ],
          tugabrot: [
            createQ(16, "tugabrot", "interactive", "Reiknaðu: 2,5 + 3,4", ["5,9", "5,90", "59", "6"], "5,9", "2+3=5 og 0,5+0,4=0,9."),
            createQ(17, "tugabrot", "interactive", "Reiknaðu: 10,5 + 2,5", ["12,5", "13", "13,5", "12,10"], "13", "0,5 + 0,5 verður 1 heill. 10+2+1=13."),
            createQ(19, "tugabrot", "interactive", "Hvaða tala er stærri: 4,2 eða 4,15?", ["4,15", "4,2", "Jafn stórar", "Ómögulegt að segja"], "4,2", "4,2 er það sama og 4,20. 20 er stærra en 15."),
            createQ(20, "tugabrot", "interactive", "Reiknaðu: 6,8 - 2,3", ["4,5", "4,3", "8,11", "3,5"], "4,5", "6-2=4 og 8-3=5."),
            createQ(21, "tugabrot", "scenario", "Þú átt 10,5 lítra af vatni. Þú hellir 2,5 lítrum niður. Hvað áttu mikið eftir?", ["8 lítra", "8,5 lítra", "12 lítra", "7,5 lítra"], "8 lítra", "10,5 - 2,5 = 8,0."),
            createQ(22, "tugabrot", "matching", "Tugabrot sem brot", null, null, "Hálfur er 0,5.", [{hugtak:"1/2", gildi:"0,5"}, {hugtak:"1/4", gildi:"0,25"}, {hugtak:"3/4", gildi:"0,75"}, {hugtak:"1/10", gildi:"0,1"}]),
            createQ(23, "tugabrot", "interactive", "Hvað er 3,9 + 0,1?", ["3,10", "4,0", "4,9", "3,91"], "4,0", "9+1 er 10, svo við fáum 0 í komuna og 1 geymdan. 3+1=4."),
            createQ(25, "tugabrot", "interactive", "Reiknaðu: 15,25 - 5,25", ["10,5", "10,25", "10", "15"], "10", "Brothlutinn (0,25) hverfur alveg."),
            createQ(26, "tugabrot", "interactive", "Hvaða tala kemur næst: 0,2 - 0,4 - 0,6 - ...?", ["0,7", "0,8", "0,12", "1,0"], "0,8", "Við bætum alltaf 0,2 við."),
            createQ(27, "tugabrot", "interactive", "2,5 milljónir + 1,5 milljónir = ?", ["3 milljónir", "3,5 milljónir", "4 milljónir", "4,5 milljónir"], "4 milljónir", "2,5 + 1,5 = 4,0."),
            createQ(28, "tugabrot", "scenario", "Ís kostaði 450,50 kr. Þú borgaðir með 500 kr pening. Hvað færðu til baka?", ["49,50 kr", "50,50 kr", "40,50 kr", "59,50 kr"], "49,50 kr", "500 - 450,5 = 49,5."),
            createQ(29, "tugabrot", "matching", "Samlagning", null, null, "Finndu summuna.", [{hugtak:"0,2 + 0,3", gildi:"0,5"}, {hugtak:"0,5 + 0,5", gildi:"1,0"}, {hugtak:"1,2 + 0,8", gildi:"2,0"}]),
            createQ(30, "tugabrot", "interactive", "Hvað vantar upp á að 0,7 verði 1 heill?", ["0,2", "0,3", "0,4", "0,1"], "0,3", "1,0 - 0,7 = 0,3.")
          ],
          neikvaedar: [
            createQ(31, "neikvaedar", "interactive", "Hvað er 5 - 8?", ["3", "-3", "2", "-2"], "-3", "Við förum 8 skref til vinstri frá tölunni 5."),
            createQ(32, "neikvaedar", "interactive", "Hvað er -2 - 3?", ["-1", "-5", "1", "5"], "-5", "Við byrjum í -2 og förum enn lengra niður (3 skref)."),
            createQ(33, "neikvaedar", "scenario", "Hitastigið var 2°C en lækkaði um 5 gráður. Hver er hitinn núna?", ["-2°C", "-3°C", "-5°C", "3°C"], "-3°C", "2 mínus 5 er -3."),
            createQ(34, "neikvaedar", "interactive", "Hvaða tala er minnst?", ["-1", "-10", "0", "1"], "-10", "Í neikvæðum tölum er talan með hærra gildið í raun minni (kaldari)."),
            createQ(36, "neikvaedar", "interactive", "Reiknaðu: -4 + 4", ["0", "-8", "8", "4"], "0", "Ef þú skuldar 4 og borgar 4, þá skuldar þú 0."),
            createQ(37, "neikvaedar", "interactive", "Reiknaðu: 10 + (-5)", ["15", "5", "-5", "-15"], "5", "Að plúsa neikvæða tölu er eins og að draga frá. 10 - 5 = 5."),
            createQ(38, "neikvaedar", "matching", "Gagnstæðar tölur", null, null, "Summa gagnstæðra talna er 0.", [{hugtak:"5", gildi:"-5"}, {hugtak:"-10", gildi:"10"}, {hugtak:"100", gildi:"-100"}]),
            createQ(39, "neikvaedar", "interactive", "Hvaða tala vantar?  -3 + ___ = 0", ["3", "-3", "0", "1"], "3", "Til að núlla út -3 þarf +3."),
            createQ(40, "neikvaedar", "scenario", "Kafbátur er á 50 metra dýpi (-50m). Hann kafar 20 metra dýpra. Hvar er hann?", ["-30m", "-70m", "-20m", "70m"], "-70m", "-50 - 20 = -70."),
            createQ(41, "neikvaedar", "interactive", "Hvað er 0 - 7?", ["7", "-7", "0", "70"], "-7", "Núll mínus sjö er mínus sjö."),
            createQ(43, "neikvaedar", "interactive", "Raðaðu frá minnstu til stærstu: 0, -5, 2, -1", ["-5, -1, 0, 2", "-1, -5, 0, 2", "0, -1, 2, -5", "2, 0, -1, -5"], "-5, -1, 0, 2", "-5 er kaldast, svo -1, svo 0, svo 2."),
            createQ(44, "neikvaedar", "interactive", "Reiknaðu: 5 - 10 + 2", ["-3", "-7", "-5", "3"], "-3", "5 - 10 = -5. Og -5 + 2 = -3."),
            createQ(45, "neikvaedar", "matching", "Orðadæmi", null, null, "Tengdu dæmi við svar.", [{hugtak:"Skuldar 10, færð 5", gildi:"-5"}, {hugtak:"Átt 5, missir 10", gildi:"-5"}, {hugtak:"Frost 2, kólnar um 3", gildi:"-5"}])
          ],
          reiknirod: [
            createQ(46, "reiknirod", "interactive", "Reiknaðu: 10 - (2 + 3)", ["5", "11", "15", "8"], "5", "Fyrst sviginn: 2+3=5. Síðan 10-5=5."),
            createQ(47, "reiknirod", "interactive", "Reiknaðu: (10 - 2) + 3", ["5", "11", "15", "8"], "11", "Fyrst sviginn: 10-2=8. Síðan 8+3=11."),
            createQ(49, "reiknirod", "interactive", "Hvaða tala vantar? 15 - (___ + 5) = 5", ["5", "0", "10", "2"], "5", "Sviginn þarf að vera 10, því 15-10=5. Inni í sviga: ? + 5 = 10. Svarið er 5."),
            createQ(50, "reiknirod", "interactive", "Reiknaðu: 2 + 3 + (4 + 1)", ["9", "10", "11", "12"], "10", "Sviginn er 5. 2+3+5=10."),
            createQ(51, "reiknirod", "scenario", "Þú kaupir 2 epli á 100 kr. Þú færð 50 kr afslátt af heildinni. Hvernig seturðu það upp?", ["(100 + 100) - 50", "100 + 100 + 50", "50 - (100+100)", "100 - 50"], "(100 + 100) - 50", "Leggja saman eplin, svo draga frá."),
            createQ(52, "reiknirod", "interactive", "50 - (20 - 10) = ?", ["20", "40", "30", "50"], "40", "20-10=10. 50-10=40."),
            createQ(53, "reiknirod", "matching", "Svigar", null, null, "Reiknaðu svigana fyrst.", [{hugtak:"10 - (2+2)", gildi:"6"}, {hugtak:"(10-2) + 2", gildi:"10"}, {hugtak:"10 - (5-2)", gildi:"7"}]),
            createQ(54, "reiknirod", "interactive", "Hvað er: (5 + 5) - (2 + 2)?", ["6", "10", "0", "4"], "6", "10 - 4 = 6."),
            createQ(56, "reiknirod", "interactive", "Hvaða tala vantar? 20 - (___) = 15", ["5", "10", "15", "0"], "5", "20 mínus 5 eru 15."),
            createQ(57, "reiknirod", "interactive", "Er munur á 10-(5+2) og 10-5-2?", ["Já", "Nei, það er sama útkoma", "Veltur á tölunum", "Aðeins í plús"], "Nei, það er sama útkoma", "Að draga frá summu (5+2) er það sama og draga báðar tölurnar frá. 10-7=3 og 10-5-2=3."),
            createQ(58, "reiknirod", "scenario", "Jón á 1000 kr. Hann kaupir gos (200kr) og nammi (300kr). Hvað á hann eftir?", ["500 kr", "600 kr", "400 kr", "300 kr"], "500 kr", "1000 - (200+300) = 500."),
            createQ(59, "reiknirod", "matching", "Finndu svarið", null, null, "Reiknaðu nákvæmlega.", [{hugtak:"20-(10-5)", gildi:"15"}, {hugtak:"(20-10)-5", gildi:"5"}, {hugtak:"20-10-5", gildi:"5"}]),
            createQ(60, "reiknirod", "interactive", "Hvað er stærst?", ["(5+5)+5", "5+(5+5)", "Allt jafn stórt", "5+5+5"], "Allt jafn stórt", "Í samlagningu skipta svigar ekki máli fyrir útkomuna (víxlin/tengin).")
          ]
        };

        // -----------------------------------------------------------------------------
        // HELPER COMPONENTS
        // -----------------------------------------------------------------------------

        const ProgressBar = ({ current, total }) => {
          const percentage = Math.round(((current + 1) / total) * 100);
          return (
            <div className="w-full bg-slate-200 rounded-full h-2.5 mb-6">
              <div 
                className="bg-indigo-600 h-2.5 rounded-full transition-all duration-500 ease-out" 
                style={{ width: `${percentage}%` }}
              ></div>
              <p className="text-xs text-slate-500 mt-1 text-right">Spurning {current + 1} af {total}</p>
            </div>
          );
        };

        const FeedbackCard = ({ isCorrect, explanation, onNext, isLast }) => (
          <div className={`mt-6 p-6 rounded-lg border-l-4 shadow-md animate-fade-in ${isCorrect ? 'bg-emerald-50 border-emerald-500' : 'bg-red-50 border-red-500'}`}>
            <div className="flex items-start">
              <div className="flex-shrink-0">
                {isCorrect ? <Check className="h-6 w-6 text-emerald-600" /> : <X className="h-6 w-6 text-red-600" />}
              </div>
              <div className="ml-3 w-full">
                <h3 className={`text-lg font-medium ${isCorrect ? 'text-emerald-800' : 'text-red-800'}`}>
                  {isCorrect ? 'Rétt svar!' : 'Því miður, það var ekki rétt.'}
                </h3>
                <div className="mt-2 text-sm text-slate-700">
                  <p>{explanation}</p>
                </div>
                <div className="mt-4 flex justify-end">
                  <button
                    onClick={onNext}
                    className={`inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white ${isCorrect ? 'bg-emerald-600 hover:bg-emerald-700' : 'bg-red-600 hover:bg-red-700'} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500`}
                  >
                    {isLast ? 'Sjá niðurstöður' : 'Næsta spurning'} <ArrowRight className="ml-2 h-4 w-4" />
                  </button>
                </div>
              </div>
            </div>
          </div>
        );

        // -----------------------------------------------------------------------------
        // MAIN APP COMPONENT
        // -----------------------------------------------------------------------------

        function App() {
          const [currentCategory, setCurrentCategory] = useState(null); // null = Valmynd
          const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
          const [scores, setScores] = useState({ saetisgildi: 0, tugabrot: 0, neikvaedar: 0, reiknirod: 0 });
          const [showSidebar, setShowSidebar] = useState(false);
          const [selectedAnswer, setSelectedAnswer] = useState(null);
          const [isSubmitted, setIsSubmitted] = useState(false);
          const [isCorrect, setIsCorrect] = useState(false);
          const [quizFinished, setQuizFinished] = useState(false);
          
          // State fyrir Matching dæmi
          const [matches, setMatches] = useState({});
          const [selectedMatchItem, setSelectedMatchItem] = useState(null);

          // Gögn fyrir núverandi flokk
          const activeQuestions = currentCategory ? gagnagrunnur[currentCategory] : [];
          const currentQuestion = activeQuestions[currentQuestionIndex];
          const activeCategoryData = currentCategory ? flokkar[currentCategory] : null;

          const handleCategorySelect = (catId) => {
            setCurrentCategory(catId);
            setCurrentQuestionIndex(0);
            setQuizFinished(false);
            setIsSubmitted(false);
            setSelectedAnswer(null);
            setMatches({});
            setShowSidebar(false);
          };

          const handleBackToMenu = () => {
            setCurrentCategory(null);
            setQuizFinished(false);
          };

          const handleOptionClick = (option) => {
            if (isSubmitted) return;
            setSelectedAnswer(option);
          };

          const checkAnswer = () => {
            if (isSubmitted) return;
            
            let correct = false;
            
            if (currentQuestion.tegund === 'matching') {
              const correctPairs = currentQuestion.por.every(p => matches[p.hugtak] === p.gildi);
              correct = correctPairs;
            } else {
              correct = selectedAnswer === currentQuestion.rettSvar;
            }

            setIsCorrect(correct);
            if (correct) {
              setScores(prev => ({ ...prev, [currentCategory]: prev[currentCategory] + 1 }));
            }
            setIsSubmitted(true);
          };

          const handleNext = () => {
            if (currentQuestionIndex < activeQuestions.length - 1) {
              setCurrentQuestionIndex(currentQuestionIndex + 1);
              setSelectedAnswer(null);
              setIsSubmitted(false);
              setIsCorrect(false);
              setMatches({});
              setShowSidebar(false);
            } else {
              setQuizFinished(true);
            }
          };

          const restartCategory = () => {
            setCurrentQuestionIndex(0);
            setScores(prev => ({ ...prev, [currentCategory]: 0 }));
            setQuizFinished(false);
            setSelectedAnswer(null);
            setIsSubmitted(false);
            setMatches({});
          };

          const handleMatchClick = (item, type) => {
            if (isSubmitted) return;

            if (selectedMatchItem) {
              if (selectedMatchItem.type === type) {
                setSelectedMatchItem({ item, type });
              } else {
                const key = type === 'hugtak' ? item : selectedMatchItem.item;
                const value = type === 'gildi' ? item : selectedMatchItem.item;
                
                setMatches({ ...matches, [key]: value });
                setSelectedMatchItem(null);
              }
            } else {
              setSelectedMatchItem({ item, type });
            }
          };

          // --- MENU VIEW ---
          if (!currentCategory) {
            return (
              <div className="min-h-screen bg-slate-100 font-sans p-6 md:p-12">
                <div className="max-w-5xl mx-auto">
                  <header className="mb-10 text-center">
                    <h1 className="text-4xl font-extrabold text-slate-800 mb-4">Stærðfræðiæfingar - Stika 3a</h1>
                    <p className="text-slate-600 text-lg">Veldu flokk til að byrja æfingarnar.</p>
                  </header>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {Object.values(flokkar).map((cat) => (
                      <button 
                        key={cat.id}
                        onClick={() => handleCategorySelect(cat.id)}
                        className="bg-white rounded-xl shadow-sm hover:shadow-xl transition-all duration-300 overflow-hidden border border-slate-200 text-left group"
                      >
                        <div className={`h-3 ${cat.litur}`}></div>
                        <div className="p-8 flex items-start space-x-6">
                          <div className={`p-4 rounded-lg bg-slate-50 group-hover:bg-slate-100 text-slate-700 transition-colors`}>
                            {cat.icon}
                          </div>
                          <div>
                            <h2 className="text-xl font-bold text-slate-800 mb-2 group-hover:text-indigo-600 transition-colors">{cat.titill}</h2>
                            <p className="text-sm text-slate-500 mb-4">{cat.skyring}</p>
                            <div className="flex items-center text-xs font-semibold text-slate-400">
                              <Star className={`w-4 h-4 mr-1 ${scores[cat.id] > 0 ? 'text-yellow-400 fill-current' : ''}`} />
                              <span>{scores[cat.id]} / {gagnagrunnur[cat.id].length} stig</span>
                            </div>
                          </div>
                        </div>
                      </button>
                    ))}
                  </div>
                </div>
              </div>
            );
          }

          // --- FINISHED VIEW ---
          if (quizFinished) {
            return (
              <div className="min-h-screen bg-slate-50 flex items-center justify-center p-4 font-sans">
                <div className="max-w-md w-full bg-white rounded-xl shadow-lg p-8 text-center relative">
                  <button onClick={handleBackToMenu} className="absolute top-4 left-4 text-slate-400 hover:text-slate-600">
                    <X className="w-6 h-6" />
                  </button>
                  
                  <div className={`mx-auto w-20 h-20 flex items-center justify-center rounded-full mb-6 ${activeCategoryData.litur} text-white`}>
                    <Star className="w-10 h-10 fill-current" />
                  </div>
                  
                  <h2 className="text-3xl font-bold text-slate-800 mb-2">Vel gert!</h2>
                  <p className="text-slate-600 mb-6">Þú hefur lokið flokknum: <br/><strong>{activeCategoryData.titill}</strong></p>
                  
                  <div className="bg-slate-50 rounded-lg p-6 mb-8 border border-slate-100">
                    <span className="block text-sm text-slate-500 font-semibold uppercase tracking-wide">Þín stig</span>
                    <span className={`block text-5xl font-extrabold mt-2 ${scores[currentCategory] === activeQuestions.length ? 'text-emerald-600' : 'text-slate-800'}`}>
                      {scores[currentCategory]} / {activeQuestions.length}
                    </span>
                  </div>

                  <div className="space-y-3">
                    <button 
                        onClick={restartCategory}
                        className="w-full flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none transition-colors"
                    >
                        <RefreshCw className="mr-2 h-5 w-5" /> Prófa aftur
                    </button>
                    <button 
                        onClick={handleBackToMenu}
                        className="w-full flex items-center justify-center px-6 py-3 border border-slate-300 text-base font-medium rounded-md text-slate-700 bg-white hover:bg-slate-50 focus:outline-none transition-colors"
                    >
                        Velja annan flokk
                    </button>
                  </div>
                </div>
              </div>
            );
          }

          // --- QUESTION VIEW ---
          return (
            <div className="min-h-screen bg-slate-100 font-sans text-slate-900 flex flex-col md:flex-row">
              
              {/* ---------------- SIDEBAR (Hliðardálkur) ---------------- */}
              <div className={`fixed inset-y-0 left-0 transform ${showSidebar ? 'translate-x-0' : '-translate-x-full'} md:relative md:translate-x-0 transition duration-200 ease-in-out z-30 w-full md:w-80 bg-white shadow-xl md:shadow-none border-r border-slate-200 flex flex-col`}>
                <div className={`p-6 ${activeCategoryData.litur} text-white flex justify-between items-center`}>
                  <div className="flex items-center space-x-2">
                    <BookOpen className="h-6 w-6" />
                    <h2 className="text-xl font-bold">Hugtakasafn</h2>
                  </div>
                  <button onClick={() => setShowSidebar(false)} className="md:hidden text-white hover:bg-white/20 p-1 rounded">
                    <X className="h-6 w-6" />
                  </button>
                </div>
                
                <div className="flex-1 overflow-y-auto p-6 space-y-6">
                  <div className="bg-slate-50 border-l-4 border-slate-400 p-4">
                    <h3 className="font-bold text-slate-900 mb-2">{activeCategoryData.titill}</h3>
                    <p className="text-sm text-slate-700 leading-relaxed mb-3">{activeCategoryData.skyring}</p>
                    <div className="bg-white p-3 rounded border border-slate-200 text-sm text-slate-600 italic">
                      <strong>Dæmi:</strong> {activeCategoryData.daemi}
                    </div>
                  </div>
                  
                  <div className="text-xs text-slate-400 mt-4 border-t pt-4">
                    <p>Þessi hliðardálkur sýnir almennar reglur. Notaðu þessar reglur til að leysa dæmið til hægri.</p>
                  </div>
                  
                  <button 
                    onClick={handleBackToMenu} 
                    className="mt-8 flex items-center text-slate-500 hover:text-indigo-600 transition-colors text-sm font-medium"
                  >
                    <ChevronLeft className="w-4 h-4 mr-1" /> Aftur í valmynd
                  </button>
                </div>
              </div>

              {/* ---------------- MAIN CONTENT (Aðalsvæði) ---------------- */}
              <div className="flex-1 p-4 md:p-8 max-w-4xl mx-auto w-full relative">
                {/* Mobile Header */}
                <div className="md:hidden flex justify-between items-center mb-6">
                  <button onClick={handleBackToMenu} className="text-slate-500 flex items-center font-medium">
                    <ChevronLeft className="w-5 h-5" /> Hætta
                  </button>
                  <button 
                    onClick={() => setShowSidebar(true)}
                    className="flex items-center text-sm font-medium text-indigo-600 bg-indigo-50 px-3 py-2 rounded-lg"
                  >
                    <HelpCircle className="w-4 h-4 mr-1" /> Hugtök
                  </button>
                </div>

                <ProgressBar current={currentQuestionIndex} total={activeQuestions.length} />

                {/* Card Container */}
                <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                  
                  {/* Question Header */}
                  <div className="bg-slate-50 px-6 py-4 border-b border-slate-100 flex items-center justify-between">
                    <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium 
                      ${currentQuestion.tegund === 'scenario' ? 'bg-purple-100 text-purple-800' : 
                        currentQuestion.tegund === 'matching' ? 'bg-blue-100 text-blue-800' : 
                        'bg-indigo-100 text-indigo-800'}`}>
                      {currentQuestion.tegund === 'scenario' ? 'Sviðsmynd' : 
                       currentQuestion.tegund === 'matching' ? 'Pörun' : 'Dæmi'}
                    </span>
                    <div className="flex items-center text-sm text-slate-400">
                        <span>Stig: {scores[currentCategory]}</span>
                    </div>
                  </div>

                  <div className="p-6 md:p-10">
                    <h2 className="text-xl md:text-2xl font-bold text-slate-800 mb-6 leading-snug">
                      {currentQuestion.spurning}
                    </h2>

                    {/* MATCHING INTERFACE */}
                    {currentQuestion.tegund === 'matching' ? (
                      <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-8 mb-6">
                        <div className="space-y-3">
                          <h4 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Hugtak</h4>
                          {currentQuestion.por.map((p, i) => (
                            <button
                              key={`hugtak-${i}`}
                              onClick={() => handleMatchClick(p.hugtak, 'hugtak')}
                              disabled={isSubmitted}
                              className={`w-full p-4 rounded-lg border-2 text-left transition-all text-sm sm:text-base ${
                                matches[p.hugtak] 
                                  ? 'border-emerald-500 bg-emerald-50 text-emerald-900' 
                                  : selectedMatchItem?.item === p.hugtak
                                    ? 'border-indigo-500 bg-indigo-50 ring-2 ring-indigo-200'
                                    : 'border-slate-200 hover:border-indigo-300 bg-white'
                              }`}
                            >
                              {p.hugtak}
                            </button>
                          ))}
                        </div>
                        <div className="space-y-3">
                          <h4 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">Gildi</h4>
                          {currentQuestion.por.map((p, i) => {
                            const isMatched = Object.values(matches).includes(p.gildi);
                            return (
                              <button
                                key={`gildi-${i}`}
                                onClick={() => handleMatchClick(p.gildi, 'gildi')}
                                disabled={isSubmitted}
                                className={`w-full p-4 rounded-lg border-2 text-left transition-all text-sm sm:text-base ${
                                  isMatched
                                    ? 'border-emerald-500 bg-emerald-50 text-emerald-900'
                                    : selectedMatchItem?.item === p.gildi
                                      ? 'border-indigo-500 bg-indigo-50 ring-2 ring-indigo-200'
                                      : 'border-slate-200 hover:border-indigo-300 bg-white'
                                }`}
                              >
                                {p.gildi}
                              </button>
                            )
                          })}
                        </div>
                      </div>
                    ) : (
                      /* STANDARD OPTIONS */
                      <div className="space-y-3">
                        {currentQuestion.valkostir && currentQuestion.valkostir.map((opt, index) => (
                          <button
                            key={index}
                            onClick={() => handleOptionClick(opt)}
                            disabled={isSubmitted}
                            className={`w-full text-left p-4 rounded-lg border-2 transition-all duration-200 flex items-center
                              ${isSubmitted && opt === currentQuestion.rettSvar 
                                ? 'border-emerald-500 bg-emerald-50 ring-1 ring-emerald-500' 
                                : isSubmitted && selectedAnswer === opt 
                                  ? 'border-red-500 bg-red-50' 
                                  : selectedAnswer === opt 
                                    ? 'border-indigo-600 bg-indigo-50 shadow-md transform scale-[1.01]' 
                                    : 'border-slate-200 hover:border-indigo-300 hover:bg-slate-50'
                              }`}
                          >
                            <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center mr-4 flex-shrink-0
                              ${isSubmitted && opt === currentQuestion.rettSvar 
                                ? 'border-emerald-600 bg-emerald-600' 
                                : selectedAnswer === opt 
                                  ? 'border-indigo-600' 
                                  : 'border-slate-300'}`}>
                              {isSubmitted && opt === currentQuestion.rettSvar && <Check className="w-4 h-4 text-white" />}
                              {!isSubmitted && selectedAnswer === opt && <div className="w-3 h-3 rounded-full bg-indigo-600" />}
                            </div>
                            <span className="font-medium text-lg">{opt}</span>
                          </button>
                        ))}
                      </div>
                    )}

                    {/* ACTION BUTTON */}
                    {!isSubmitted && (
                      <div className="mt-8">
                         <button
                          onClick={checkAnswer}
                          disabled={currentQuestion.tegund === 'matching' ? Object.keys(matches).length !== currentQuestion.por.length : !selectedAnswer}
                          className={`w-full py-4 px-6 rounded-lg font-bold text-lg shadow-lg transition-transform transform active:scale-95
                            ${(currentQuestion.tegund === 'matching' ? Object.keys(matches).length === currentQuestion.por.length : selectedAnswer)
                              ? 'bg-indigo-600 text-white hover:bg-indigo-700' 
                              : 'bg-slate-200 text-slate-400 cursor-not-allowed'}`}
                        >
                          Svara
                        </button>
                      </div>
                    )}

                    {/* FEEDBACK AREA */}
                    {isSubmitted && (
                      <FeedbackCard 
                        isCorrect={isCorrect} 
                        explanation={currentQuestion.utskyring} 
                        onNext={handleNext}
                        isLast={currentQuestionIndex === activeQuestions.length - 1}
                      />
                    )}
                  </div>
                </div>
              </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>